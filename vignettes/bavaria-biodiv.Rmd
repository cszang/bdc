---
title: "Biodiversity of Bavaria"
author: "RS-eco"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: yes
    toc_depth: '4'
  html_document:
    toc: yes
    toc_depth: 4
editor_options: null
  chunk_output_type: console
chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  results="asis", cache=TRUE,
  echo=F, warning=F, message=F,
  fig.width=10, fig.height=8
)
```

```{r load_pkgs}
library(tidyverse)
library(lubridate)
library(ggspatial)
library(ggsci)
library(ggthemes)
library(patchwork)
library(zoo)

# Define standard colour scheme
bluewhitered <- colorRampPalette(c("#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"))(255)
#pie(rep(1,7),col=c("#009392","#39b185","#9ccb86","#e9e29c","#eeb479","#e88471","#cf597e"))
```

```{r}
# Load shapefile of Bavaria
data("bavaria", package="bdc")
bavaria <- sf::st_as_sf(bavaria)
```

# General information

<!--An analysis of the Euro-Codex data for Europe can be found here: https://www.dkrz.de/projekte-und-partner/HLRE-Projekte/focus/regionale-klimaprojektionen-fuer-europa
-->

# Data Analysis

Here, I perform a first analysis of different biodiversity data for Bavaria.

```{r}
data("amphibians_bav", package="bdc")
data("bird_bav", package="bdc")
data("gard_reptiles_bav", package="bdc")
data("mammals_bav", package="bdc")
data("odonata_bav", package="bdc")
data("reptiles_bav", package="bdc")

data("tk25_grid", package="bdc")
tk25_grid <- tk25_grid %>% raster::rasterFromXYZ()
raster::projection(tk25_grid) <- sp::CRS("+init=epsg:31468")
tk25_grid <- raster::projectRaster(tk25_grid, crs=sp::CRS("+init=epsg:4326"))

nrow(amphibians_bav); sum(amphibians_bav$presence)

dat <- raster::rasterize(amphibians_bav, tk25_grid) %>% raster::mask(tk25_grid) %>% 
  raster::rasterToPoints() %>% data.frame()
colnames(dat)

# Plot species richness of individual taxa
dat %>% group_by(x,y) %>% summarise(sr=sum(layer)) %>% 
  ggplot() + geom_tile(aes(x=x,y=y,fill=sr)) + coord_sf()


```

